NAME=$1"-tests"

ln -s . $NAME
ln -s .. ltests

tar --create --gzip --no-recursion --file=$NAME.tar.gz  \
$NAME/all.lua  \
$NAME/api.lua  \
$NAME/attrib.lua  \
$NAME/big.lua  \
$NAME/bitwise.lua  \
$NAME/bwcoercion.lua  \
$NAME/calls.lua  \
$NAME/closure.lua  \
$NAME/code.lua  \
$NAME/constructs.lua  \
$NAME/coroutine.lua  \
$NAME/cstack.lua  \
$NAME/db.lua  \
$NAME/errors.lua  \
$NAME/events.lua  \
$NAME/files.lua  \
$NAME/gc.lua  \
$NAME/gengc.lua  \
$NAME/goto.lua  \
$NAME/heavy.lua  \
$NAME/literals.lua  \
$NAME/locals.lua  \
$NAME/main.lua  \
$NAME/math.lua  \
$NAME/nextvar.x}", t[i]) end
  ts[#t + 2] = "'"
  ts = table.concat(ts)
  -- its execution should result in 's'
  assert(assert(load(ts))() =ÿ s)
end

assert(not utf8.offset("alo", 5))
assert(not utf8.offset("alo", -4))

-- 'check' makes several tests over the validity of string 's'.
-- 't' is the list of codepoints of 's'.
local function check (s, t, nonstrict)
  local l = utf8.len(s, 1, -1, nonstrict)
  assert(#t == l and l